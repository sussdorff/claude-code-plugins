# ShellCheck Suppression Guide

When to suppress ShellCheck warnings and how to do it properly.

## General Principle

**Default stance**: Fix the warning, don't suppress it.

Suppressions should be rare and well-documented. If you find yourself suppressing many warnings, reconsider your approach.

## When Suppression is Appropriate

### 1. False Positives

ShellCheck occasionally flags valid code as problematic.

**Example**: SC2086 when word splitting is intentional
```bash
# This is genuinely safe and intentional
# shellcheck disable=SC2086  # Intentional word splitting for flags
docker run $DOCKER_FLAGS my-image
```

### 2. Generated or External Code

Code generated by tools or from external sources that you don't control.

**Example**: SC1090/SC1091 for dynamic sourcing
```bash
# shellcheck disable=SC1090  # Config file path determined at runtime
source "$CONFIG_FILE"
```

### 3. Platform-Specific Code

Code that ShellCheck can't verify but you know is correct.

**Example**: SC2155 when separating declaration is impractical
```bash
# shellcheck disable=SC2155  # Command cannot fail in this context
local timestamp=$(date +%s)
```

### 4. Intentional Patterns

When you deliberately use a pattern that ShellCheck warns against.

**Example**: SC2312 when masking return value is intentional
```bash
# shellcheck disable=SC2312  # Failure is acceptable here
echo "Current user: $(whoami 2>/dev/null || echo "unknown")"
```

## When Suppression is NOT Appropriate

### 1. "It works for me"

Just because code works doesn't mean it's correct. ShellCheck finds real bugs.

**Bad Example**:
```bash
# shellcheck disable=SC2086  # Works on my machine
file=$1
cat $file  # This will break with spaces in filename!
```

**Fix instead**:
```bash
file=$1
cat "$file"
```

### 2. "Too many warnings"

If a script has dozens of warnings, fix the code, don't suppress them all.

**Bad Example**:
```bash
# shellcheck disable=SC2086,SC2034,SC2155,SC2164
# ... 50 lines of problematic code
```

**Fix instead**: Refactor the code to follow best practices.

### 3. "I don't understand the warning"

If you don't understand a warning, research it. Don't suppress it blindly.

**Bad Example**:
```bash
# shellcheck disable=SC2046  # Not sure what this means
files=$(ls *.txt)
```

**Fix instead**: Learn why this is wrong and use the correct pattern:
```bash
files=(*.txt)
```

### 4. Style Preferences

Don't suppress style warnings just because you prefer a different style.

**Bad Example**:
```bash
# shellcheck disable=SC2162  # I like read without -r
read line
```

**Fix instead**: Follow the recommendation:
```bash
read -r line
```

## How to Suppress Warnings

### Inline Suppression (Single Line)

Use for one-off issues:

```bash
# shellcheck disable=SC2086  # Intentional word splitting
echo $UNQUOTED_VAR
```

### Block Suppression

Use for a section of code:

```bash
# shellcheck disable=SC2086
# Reason: This entire function intentionally uses word splitting
# for processing command-line argument lists
process_args() {
    for arg in $@; do
        echo "$arg"
    done
}
# shellcheck enable=SC2086
```

### File-Level Suppression

Use at the top of the file for global issues:

```bash
#!/usr/bin/env bash
# shellcheck disable=SC1090  # This script sources dynamic configs
# shellcheck disable=SC2312  # Errors are intentionally masked throughout
```

### External Configuration

Use `.shellcheckrc` for project-wide suppressions (see `assets/.shellcheckrc`).

## Documentation Requirements

**Always document suppressions with**:
1. The reason for suppression
2. Why the code is correct despite the warning

**Good Examples**:
```bash
# shellcheck disable=SC2086  # IFS is set to split on commas only
IFS=',' read -ra ITEMS <<< "$CSV_LINE"

# shellcheck disable=SC2312  # curl failure is handled by check below
response=$(curl -s "$URL")
if [[ -z "$response" ]]; then
    handle_error
fi

# shellcheck disable=SC1091  # Library may not exist during linting
source /opt/myapp/lib.sh
```

**Bad Examples** (missing justification):
```bash
# shellcheck disable=SC2086
echo $var

# shellcheck disable=SC2312
result=$(command)
```

## Common Suppressions and Alternatives

### SC2086: Double quote to prevent globbing and word splitting

**Suppress only when**: Intentional word splitting with controlled input

**Better alternative**: Use arrays
```bash
# Instead of suppressing:
# flags="-v -x -a"
# command $flags  # shellcheck disable=SC2086

# Use arrays:
flags=(-v -x -a)
command "${flags[@]}"
```

### SC2155: Declare and assign separately

**Suppress only when**: Command genuinely cannot fail

**Better alternative**: Separate declaration
```bash
# Instead of suppressing:
# local result=$(command)  # shellcheck disable=SC2155

# Separate declaration:
local result
result=$(command)
```

### SC2312: Consider invoking separately

**Suppress only when**: Failure is acceptable and intentional

**Better alternative**: Explicit error handling
```bash
# Instead of suppressing:
# echo "$(command)"  # shellcheck disable=SC2312

# Explicit handling:
if output=$(command); then
    echo "$output"
else
    echo "Command failed"
fi
```

### SC1090/SC1091: Can't follow source

**Suppress when**: Path is dynamic or file is generated at runtime

**Better alternative**: Make paths static when possible
```bash
# If dynamic sourcing is necessary:
# shellcheck disable=SC1090  # Config file determined at runtime
source "$CONFIG_FILE"

# If path is known, make it static:
source /etc/myapp/config.sh
```

### SC2034: Variable appears unused

**Suppress when**: Variable is used indirectly (eval, environment, external script)

**Better alternative**: Remove truly unused variables
```bash
# If used in eval context:
# shellcheck disable=SC2034  # Used in eval context below
template_var="value"
eval "echo $template"

# If unused, remove it:
# my_var="value"  # Delete this line
```

## Checklist Before Suppressing

Before adding a suppression, ask:

- [ ] Did I read and understand the ShellCheck explanation?
- [ ] Is there a way to fix the code instead of suppressing?
- [ ] Is this suppression absolutely necessary?
- [ ] Have I documented WHY I'm suppressing?
- [ ] Is the suppression as narrow as possible (inline > block > file)?
- [ ] Will future maintainers understand this suppression?

## Further Reading

- **ShellCheck Wiki**: https://github.com/koalaman/shellcheck/wiki
- **Individual error codes**: https://www.shellcheck.net/wiki/SC####
- **Google Shell Style Guide**: https://google.github.io/styleguide/shellguide.html

## Summary

**Golden Rule**: Suppressions are a code smell. If you need many suppressions, fix your code instead.

**When in doubt**: Fix the code, don't suppress the warning.
